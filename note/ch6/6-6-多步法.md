# 6-6-多步法 (Multistep methods)

这是一份数值计算学习笔记，参考了 Tobin A. Driscoll and Richard J. Braun 的教材 [*Fundamentals of Numerical Computation* (2023)](https://tobydriscoll.net/fnc-julia/home.html).

> 这份笔记主要是翻译了原文内容，并删改或重新表述部分内容，希望能进一步减少初学者的学习障碍.

**#1 多步法的基本想法**

在 Runge-Kutta 方法里，我们从 $u_i$ 出发，用多个 stage 的 $f(t,u)$ 评估去得到 $u_{i+1}$ (见 **6-4-Runge-Kutta-方法**). 多步法则走另一条路：它通过利用更多的历史信息 (过去若干步的解与导数) 来提高精度，通常每步只需要一个新的 $f$ 评估 (前提是我们保存最近的历史).

为便于书写，记

$$
f_i=f(t_i,u_i).
$$

> **Definition:** Multistep method for IVPs
> A $k$-step multistep (linear multistep) method is given by the difference equation
> $$
> u_{i+1}=a_{k-1}u_i+\cdots+a_0u_{i-k+1}+h\bigl(b_k f_{i+1}+\cdots+b_0 f_{i-k+1}\bigr),
> $$
> where the $a_j$ and $b_j$ are constants. If $b_k=0$, the method is explicit; otherwise, it is implicit.

上式里 $u$ 与 $f$ 虽然写成标量，但一般也可以是向量. 为了把它当作数值方法使用，我们让 $i=k-1,\dots,n-1$ 依次推进. 初值问题给出 $u_0$，但还需要提供

$$
u_1=\alpha_1,\ \dots,\ u_{k-1}=\alpha_{k-1},
$$

作为启动值. 实务中这些启动值常用某个 RK 方法来生成.

显式多步法 ($b_k=0$) 的 (6.6.2) 直接给出 $u_{i+1}$，因此每步只需要一个新的 $f$ 评估即可 (其余 $f$ 值来自历史). 隐式多步法 ($b_k\ne 0$) 则会出现

$$
u_{i+1}-hb_k f(t_{i+1},u_{i+1}) = F(u_i,u_{i-1},\dots,u_{i-k+1}),
$$

未知量 $u_{i+1}$ 出现在 $f(t_{i+1},u_{i+1})$ 里，因此每步通常需要解一个非线性方程 (求根问题). 两类方法的实现细节会在 **6-7-多步法的实现** 展开.

**#2 常见家族: Adams 与 BD**

多步法由少量系数完全决定. 常用方法包括：

- Adams–Bashforth (AB)：显式.
- Adams–Moulton (AM)：隐式.
- backward differentiation formulas (BD)：隐式.

通常我们把方法按精度阶命名，例如 AB3 表示三阶 Adams–Bashforth 方法.

下面两张表给出常用方法的系数 (并列出方法阶数). Adams 方法满足 $a_{k-1}=1$ 且 $a_{k-2}=\cdots=a_0=0$.

$$
\begin{array}{c c c c c c c}
\hline
\text{name/order} & k & b_k & b_{k-1} & b_{k-2} & b_{k-3} & b_{k-4}\\
\hline
\text{AB1 (Euler)} & 1 & 0 & 1 & & & \\
\text{AB2} & 2 & 0 & \frac{3}{2} & -\frac{1}{2} & & \\
\text{AB3} & 3 & 0 & \frac{23}{12} & -\frac{16}{12} & \frac{5}{12} & \\
\text{AB4} & 4 & 0 & \frac{55}{24} & -\frac{59}{24} & \frac{37}{24} & -\frac{9}{24}\\
\text{AM1 (Backward Euler)} & 1 & 1 & & & & \\
\text{AM2 (Trapezoid)} & 1 & \frac{1}{2} & \frac{1}{2} & & & \\
\text{AM3} & 2 & \frac{5}{12} & \frac{8}{12} & -\frac{1}{12} & & \\
\text{AM4} & 3 & \frac{9}{24} & \frac{19}{24} & -\frac{5}{24} & \frac{1}{24} & \\
\text{AM5} & 4 & \frac{251}{720} & \frac{646}{720} & -\frac{264}{720} & \frac{106}{720} & -\frac{19}{720}\\
\hline
\end{array}
$$

BD 方法满足 $b_{k-1}=\cdots=b_0=0$，只在 $f_{i+1}$ 上有系数.

$$
\begin{array}{c c c c c c c}
\hline
\text{name/order} & k & a_{k-1} & a_{k-2} & a_{k-3} & a_{k-4} & b_k\\
\hline
\text{BD1 (Backward Euler)} & 1 & 1 & & & & 1\\
\text{BD2} & 2 & \frac{4}{3} & -\frac{1}{3} & & & \frac{2}{3}\\
\text{BD3} & 3 & \frac{18}{11} & -\frac{9}{11} & \frac{2}{11} & & \frac{6}{11}\\
\text{BD4} & 4 & \frac{48}{25} & -\frac{36}{25} & \frac{16}{25} & -\frac{3}{25} & \frac{12}{25}\\
\hline
\end{array}
$$

**#3 生成多项式与移位算子写法**

多步法也可以用两个 generating polynomials 来描述：

$$
\rho(z)=z^k-a_{k-1}z^{k-1}-\cdots-a_0,\qquad
\sigma(z)=b_k z^k+b_{k-1}z^{k-1}+\cdots+b_0.
$$

例如 AB3 由

$$
\rho(z)=z^3-z^2,\qquad
\sigma(z)=\frac{1}{12}(23z^2-16z+5)
$$

确定.

> **Observation:** Basic properties of generating polynomials
> Let $\rho$ and $\sigma$ be the generating polynomials of a multistep method. Then:
> 1. $\rho$ is monic.
> 2. $\deg(\rho)=k$ (the number of steps).
> 3. $\deg(\sigma)=k$ for an implicit method and $<k$ for an explicit method.

为了把 $\rho,\sigma$ 与差分公式联系起来，引入 forward-shift operator $Z$，使得 $Zt_i=t_{i+1}$，$Zu_{i-1}=u_i$，等等. 用它可以把 (6.6.2) 简写成

$$
\rho(Z)u_{i-k+1}=h\,\sigma(Z)f_{i-k+1}.
$$

**#4 截断误差与精度阶**

多步法的 local truncation error (LTE) 与精度阶定义可以直接推广.

> **Definition:** LTE and order of accuracy for a multistep IVP method
> The local truncation error is
> $$
> \tau_{i+1}(h)=\frac{\hat u(t_{i+1})-a_{k-1}\hat u(t_i)-\cdots-a_0\hat u(t_{i-k+1})}{h}
> -\Bigl[b_k f(t_{i+1},\hat u(t_{i+1}))+\cdots+b_0 f(t_{i-k+1},\hat u(t_{i-k+1}))\Bigr].
> $$
> If $\tau_{i+1}(h)=O(h^p)$, then $p$ is the order of accuracy of the formula. If $p>0$, the method is consistent.

> **Example:** AM1 / backward Euler
> AM1 is $u_{i+1}=u_i+h f_{i+1}$, with $\rho(z)=z-1$ and $\sigma(z)=z$.
> Substituting the exact solution and doing a Taylor expansion gives $\tau_{i+1}(h)=O(h)$, hence AM1 is first order.

> **Example:** AB2
> AB2 is $u_{i+1}=u_i+h\left(\frac{3}{2}f_i-\frac{1}{2}f_{i-1}\right)$, with $\rho(z)=z^2-z$ and $\sigma(z)=\frac{1}{2}(3z-1)$.
> A Taylor expansion shows $\tau_{i+1}(h)=O(h^2)$, hence AB2 is second order.

本章不展开完整分析，但这里关心的结论与一步法类似：上面两张表中的多步法，其 global error 的收敛阶与 LTE 的阶一致.

**#5 系数从哪里来**

Adams 方法的推导从积分形式开始：

$$
\hat u(t_{i+1})=\hat u(t_i)+\int_{t_i}^{t_{i+1}} \hat u'(t)\,dt
=\hat u(t_i)+\int_{t_i}^{t_{i+1}} f(t,\hat u(t))\,dt.
$$

对 $k$-step Adams 方法，总有 $\rho(z)=z^k-z^{k-1}$. 由于积分区间内的 integrand 不可得，我们用历史的 $f$ 值做插值多项式近似它，再对插值多项式做解析积分，从而得到系数 $b_0,\dots,b_k$.

> **Example:** AM2 (trapezoid)
> Use the two values $(t_i,f_i)$ and $(t_{i+1},f_{i+1})$ and the linear interpolant
> $$
> p(t)=f_i\frac{t_{i+1}-t}{t_{i+1}-t_i}+f_{i+1}\frac{t-t_i}{t_{i+1}-t_i}.
> $$
> With $s=t-t_i$ and $h=t_{i+1}-t_i$,
> $$
> \int_{t_i}^{t_{i+1}} p(t)\,dt
> =\int_0^h p(t_i+s)\,ds
> =\frac{h}{2}(f_i+f_{i+1}).
> $$
> Hence AM2 is the trapezoid method for IVPs.

AB 方法使用 $k$ 个历史点插值 integrand，因此插值误差是 $O(h^k)$，积分后得到局部误差 $O(h^{k+1})$，从而全局误差是 $O(h^k)$. AM 方法的插值多项式次数高一阶，因此在相同步数下精度阶通常也高一阶.

BD 方法的思路与 Adams 互补：先用多项式 $q$ 插值历史的解值 $u_{i+1},\dots,u_{i-k+1}$，然后借由 $f(t,\hat u)=\hat u'(t)$ 在 $t_{i+1}$ 处施加

$$
f_{i+1}=q'(t_{i+1}).
$$

再用有限差分把 $q'(t_{i+1})$ 表示成历史解值的组合，得到 BD 的系数.

最后，一个自然问题是：既然启动时往往还需要 RK 方法来提供初值，为什么还要多步法？核心原因是效率：在某些问题里，即使在相同的精度阶下，多步法也可能更省函数评估，从而更快.
